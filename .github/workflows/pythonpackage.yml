name: Site Autobuild 

on: 
  schedule:
    - cron: '15 * * * *'
    
jobs:
  build:

    runs-on: ubuntu-latest
    strategy:
      max-parallel: 4
      matrix:
        python-version: [3.7]

    steps:
    - uses: actions/checkout@master
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    - name: Poll API
      run: python src/main.py
    - name: Actually COMMIT the changes
      run: |
        git config user.email "action@githubactions.com"
        git config user.name "Site Autobuilder"
        git merge --strategy-option theirs 
        git add .
        git commit -m 'Autogenerated site via Github Actions.'
    - name: GitHub Push
      uses: ad-m/github-push-action@v0.5.0
      with:
        # Token for the repo. Can be passed in using $\{{ secrets.GITHUB_TOKEN }}
        github_token: ${{ secrets.PAT }}
        # Destination branch to push changes
        branch: master
        # Determines if force push is used
        force: false
        # Directory to change to before pushing.
        directory: .
